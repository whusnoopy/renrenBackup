# 相册和照片

本来是打算比较高优先级来弄相册的，但粗看了下结构比较复杂，请求也繁杂无序，就放到后面做了。

相册的展示结构分三层，最外面是相册列表页，然后每个相册点开会有一个相册的详情页，就是相册内照片的列表页，然后再是每张照片的信息


## 相册列表页

相册列表页没找到对应的翻页 xhr 请求（也可能是我相册太少，一页就展示完了所以没法构建对应请求），那只能去解析页面

本打算用 `BeautifulSoup` 或 `PyQuery` 之类的库，或封装的更好的 `requests-html` 来做的，后面发现装这几个库都依赖 `libxml`，而 `libxml` 在 Windows 下又出了名的难装，还是人肉做算了

看了下页面内嵌的 js，把 `albumList: [xxx]` 这部分拿出来，就可以得到对应的相册 id 和相册名，以及相册内的照片数量，对我们来说足够了，直接正则匹配之

翻页和总数的问题直接绕开，就看某页翻过去是否不够每页相册数就好

> 2018-11-19 更新：在 #11 里提到过非登陆者的加密相册，解析相册列表页信息时会拿不到对应数据，在 #15 修复


## 相册详情页

本想在这里做照片翻页查看等信息，结果发现有更简单的做法。人人有一个弹层浏览相册的特性，点开后有一个 xhr 请求直接能拿到相册和里面所有照片的详细信息，那就直接构建这个请求就好

拿全部信息的 xhr 请求需要一个照片 id 的参数，这个参数只能在相册详情页通过解析页面里内嵌的 js 得到，人肉分析了下直接找 `"PhotoId": "xxx","yyy"` 这边的第一个就好，还是可以正则匹配而不用上各种库的

这里有一个小坑是相册的封面可能是不存在的，对于这种情况，我们强行用相册内的第一涨图来替代就好


## 照片详情页

通过上面那个超大请求，直接也拿到相册内照片的各种数据了

很多无关的信息都可以不要，比如 EXIF 啥的（至少我觉得没啥用了，解析起来还麻烦），比如各种尺寸可以只留最大的，反正我们在本地看，不用考虑各种尺寸的 CDN 加速

这里的一个坑是照片的时间只精确到日，且格式是 `%Y年%m月%d日` 这样的格式，py2 和 py3 对中文的处理不一样，在 `datetime.strptime` 之前要先做好转码工作

另一个后来做展示才发现的问题是照片并不是按 id 有序的，而是相册里可以任意调换顺序，这时候记录每张照片在当前相册里的编号就有意义了

为了做展示时方便前后翻，把上一张下一张的照片 ID 也存起来，第一张和最后一张做成循环
